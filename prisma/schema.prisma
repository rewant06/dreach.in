generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// Enums
//
enum UserRole {
  PATIENT
  DOCTOR
  SUPERADMIN
  ADMIN
  LAB
  HOSPITAL
  NURSING
  DOCTORSASSISTANT
}

enum ProviderType {
  DOCTOR
  HOSPITAL
  LAB
  NURSING
}

enum ServiceType {
  HomeCare
  VideoConsultation
  OndeskAppointment
  IntegratedCare
  CollaborativeCare
  LabTest
}

enum PaymentStatus {
  PAID
  PENDING
  REFUNDED
  FAILED
}

enum PaymentMethod {
  UPI
  CARD
  NET_BANKING
  CASH
  WALLET
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

//
// Core Models
//
model User {
  id                String   @id @default(cuid())
  name              String
  email             String   @unique
  password          String
  phone             String
  role              UserRole
  dateOfBirth       DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  patient           Patient?
  doctor            Doctor?
  superAdmin        SuperAdmin?
  admin             Admin?
  lab               Lab?
  hospital          Hospital?
  nursing           Nursing?
  doctorsAssistant  DoctorsAssistant?
  payments          Payment[]
  medicalRecords    MedicalRecord[]
  appointments      Appointment[]

}

// Admin Model

model SuperAdmin {
  id                String   @id @default(cuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id])
  permissions       String[]
}   

model Admin {
  id                String   @id @default(cuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id])
  permissions       String[]
  canManageProviders Boolean @default(true)
  canViewAllTransactions Boolean @default(true)
  canViewAllAppointments Boolean @default(true)
}
// Service User Model

model Patient {
  id                String   @id @default(cuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id])
  address           String
  conditions        String[]
  allergies         Allergy[]
  bloodGroup        String
  treatmentPlans    TherapyPlan[]
  appointments      Appointment[]
  prescriptions     Prescription[]
  labResults        LabResult[]
  medications       Medication[]
  feedbacks         Feedback[]
}

// Service Provider Models

model ServiceProvider {
   id                String   @id @default(cuid())
  name              String
  providerType      ProviderType
  feedbacks         Feedback[] // Relation to Feedback
  
  
}

model Doctor {
  id                String   @id @default(cuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id])
  specialization    String
  hospitalId        String?
  prescriptions     Prescription[]
  labResults        LabResult[]
  medications       Medication[]
  assistants        DoctorsAssistant[]
  therapyPlans      TherapyPlan[]
  requests          Request[]
  
}

model DoctorsAssistant {
  id                String   @id @default(cuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id])
  assignedDoctorId  String
  doctor            Doctor   @relation(fields: [assignedDoctorId], references: [id])
  requestPermissions       RequestPermission[]
  
}


model Lab {
  id                String   @id @default(cuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id])
  servicesOffered   String[]
  
}

model Hospital {
  id                String   @id @default(cuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id])
  servicesOffered   String[]
  
}

model Nursing {
  id                String   @id @default(cuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id])
  servicesOffered   String[]
  
}




//
//Service Models
//

model Service {
  id              Int    @id @default(autoincrement())
  name            ServiceType
  description     String 
}

//
// Payment and Transaction Models
//
model Payment {
  id                String   @id @default(cuid())
  transactionId     String   @unique
  amount            Float
  status            PaymentStatus
  paymentMethod     PaymentMethod
  paymentDate       DateTime @default(now())
  refundDetails     String?
  userId            String
  user              User     @relation(fields: [userId], references: [id])
  appointmentId     String?
  appointment       Appointment? @relation(fields: [appointmentId], references: [id])

  transaction       Transaction[] // Relation to Transaction (no `fields` or `references` here)
}

model Transaction {
  id                String   @id @default(cuid())
  gatewayTransactionId String @unique
  amount            Float
  status            PaymentStatus
  paymentMethod     PaymentMethod
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  refundDetails     String?
  paymentId         String   @unique // Marked as `@unique` for one-to-one relation
  payment           Payment  @relation(fields: [paymentId], references: [id])
}

//
// Appointment and Related Models
//
model Appointment {
  id                String   @id @default(cuid())
  dateTime          DateTime
  bookedAt          DateTime @default(now())
  status            AppointmentStatus
   patientId         String
  patient           Patient  @relation(fields: [patientId], references: [id])
  userId            String
  user              User     @relation(fields: [userId], references: [id])
  payments          Payment[]
}

model TherapyPlan {
  id                String   @id @default(cuid())
  planName          String
  date              DateTime
  type              String
  status            String
  details           String
  patientId         String
  doctorId          String
  patient           Patient  @relation(fields: [patientId], references: [id])
  doctor            Doctor   @relation(fields: [doctorId], references: [id])
}

//
// Medical Models
//
model Allergy {
  id                String   @id @default(cuid())
  allergen          String
  type              String
  severity          String
  reaction          String
  patientId         String
  patient           Patient  @relation(fields: [patientId], references: [id])
}

model Medication {
  id                String   @id @default(cuid())
  name              String
  dosage            String
  frequency         String
  duration          String
  status            String
  patientId         String
  patient           Patient  @relation(fields: [patientId], references: [id])
  doctorId          String?  // Added field for relation with Doctor
  doctor            Doctor?  @relation(fields: [doctorId], references: [id])
  prescriptionId    String?  // Added field for relation with Prescription
  prescription      Prescription?  @relation(fields: [prescriptionId], references: [id])
}

model LabResult {
  id                String   @id @default(cuid())
  testName          String
  testDate          DateTime
  result            String
  referenceRange    String
  status            String
  patientId         String
  patient           Patient  @relation(fields: [patientId], references: [id])
  doctorId          String?  // Added field for relation with Doctor
  doctor            Doctor?  @relation(fields: [doctorId], references: [id])
}

model MedicalRecord {
  id                String   @id @default(cuid())
  
  diagnosis         String
  prescription      String
  notes             String?
  userId            String
  user              User     @relation(fields: [userId], references: [id])
  
}

model Prescription {
  id                String   @id @default(cuid())
  patientId         String
  doctorId          String
  medications       Medication[]
  notes             String?
  dateIssued        DateTime
  patient           Patient  @relation(fields: [patientId], references: [id])
  doctor            Doctor   @relation(fields: [doctorId], references: [id])
}



// Permission, Request, Access Models

model RequestPermission {
  id                String   @id @default(cuid())
  name              String   // Name of the permission (e.g., "Manage Users")
  description       String?  // Optional description of the permission
  accessType        PermissionType // Enum to define the type of access (e.g., View, Edit, Delete)
  requests          Request[] // Relation to multiple requests that use this permission

 doctorsAssistantId String?
 doctorsAssistant   DoctorsAssistant? @relation(fields: [doctorsAssistantId], references: [id])
}

enum PermissionType {
  ACCEPT
  REJECT
  PENDING
  VIEW
  EDIT
  DELETE
  CREATE
  UPDATE
}

model Request {
  id                String   @id @default(cuid())
  requestPermissions   RequestPermission[] // Many-to-many relation with Permission
  status            RequestStatus // Enum to define the status of the request
  createdAt         DateTime @default(now()) // Timestamp for when the request was created
  updatedAt         DateTime @updatedAt // Timestamp for when the request was last updated

  doctorId          String?
  doctor            Doctor? @relation(fields: [doctorId], references: [id])
}

enum RequestStatus {
  PENDING
  ACCEPTED
  REJECTED
}


// Feedback and Review Models

model Feedback {
  id                String   @id @default(cuid())
  patientId         String
  rating            Float
  review            String
  patient           Patient?  @relation(fields: [patientId], references: [id])
  serviceProviderId String
  serviceProvider   ServiceProvider? @relation(fields: [serviceProviderId], references: [id])
}